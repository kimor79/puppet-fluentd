<match <%= @pattern %>>
    type <%= @type %>
<%- @config.sort_by{|key,val|key}.each do |key, val| -%>
  <%- if @type == 'copy' && key == 'store' -%>
    <%- val.each do |store| -%>
        <store>
      <%- store.sort_by{|k,v|k}.each do |k, v| -%>
        <%- if k == 'servers' -%>
          <%- v.each do |server| -%>
            <server>
            <%- server.sort_by{|sk,sv|sk}.each do |sk, sv| -%>
              <%= k %> <%= v %>
            <%- end -%>
            </server>
          <%- end -%>
        <%- else -%>
          <%= k %> <%= v %>
        <%- end -%>
      <%- end -%>
        </store>
    <%- end -%>
  <%- else -%>
    <%= key %> <%= val %>
  <%- end -%>
<%- end -%>
<%- @servers.each do |server| -%>
    <server>
  <%- server.sort_by{|key,val|key}.each do |key, val| -%>
    <%= key %> <%= val %>
  <%- end -%>
    </server>
<%- end -%>
</match>
